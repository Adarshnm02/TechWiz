<%- include('../partials/user/header') %>



<section class="checkout spad ">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h6>
                    <!-- Have a coupon? <a href="#">Click here</a> to enter your code (class="icon_tag_alt")-->
                </h6>
            </div>
        </div>
        <div class="checkout__form">
            <h4>Edit Address</h4>
            <form action="/profile/editProfile/<%= user._id %>" method="post" id="editProfileForm">

                <div class="row d-flex justify-content-center align-items-center ">
                    <div class="col-lg-8 col-md-6">

                        <div class="checkout__input">
                            <p>Full Name<span>*</span></p>
                            <input type="text" name="userName" value="<%= user.userName %>">
                        </div>

                        <div class="row">
                            <div class="col-lg-6">
                                <div class="checkout__input">
                                    <p>Phone<span>*</span></p>
                                    <input type="number" name="mobile" value="<%= user.mobile %>">
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="checkout__input">
                                    <p>Email<span>*</span></p>
                                    <input type="email" name="email" value="<%= user.email %>">
                                    <p id="emailError"></p>
                                </div>
                            </div>
                        </div>

                       
                        
                        <div class="edit-address">
                            <a onclick="emailValidation('<%=user._id%>')"><button type="submit">Submit</button></a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>



<script>
    const couponForm = document.getElementById("editProfileForm");
    const emailInput = document.querySelector("input[name='email']");
    const emailError = document.getElementById("emailError");

    function emailValidation(userId) {
        if (emailInput.value.trim() === "") {
            emailError.innerHTML = "Please enter your Email Address!";
            return false;
        } else if (!(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(emailInput.value))) {
            emailError.innerHTML = "Please enter a valid Email address.";
            return false;
        } else {
            emailError.innerHTML = "";
            return true;
        }
   

    couponForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const validations = [emailValidation(userId)];
        const hasErrors = validations.some(validation => validation === false);

        if (!hasErrors) {
            const formData = new FormData(couponForm);

            fetch(`/profile/editProfile/${userId}`, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // return response.json();
            })
            .then(data => {
                // Handle success, if needed
                // console.log(data);
                window.location.href = '/profile'; 
            })
            .catch(error => {
                console.error('There was an error!', error);
                
            });
        }
    });

}
</script>



<%- include('../partials/user/footer') %>